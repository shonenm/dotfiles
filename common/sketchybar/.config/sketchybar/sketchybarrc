PLUGIN_DIR="$CONFIG_DIR/plugins"
source "$PLUGIN_DIR/accent_color.sh"

##### Bar Appearance #####
sketchybar --bar position=top height=28 color=0x00000000 topmost=on y_offset=30 margin=0 padding_right=10

##### Changing Defaults #####
default=(
  padding_left=2
  padding_right=2
  icon.font="Hack Nerd Font:Bold:14.0"
  label.font="Hack Nerd Font:Bold:12.0"
  icon.color=0xffffffff
  label.color=0xffffffff
)
sketchybar --default "${default[@]}"

##### AeroSpace Events #####
sketchybar --add event aerospace_workspace_change
sketchybar --add event aerospace_mode_change

##### Claude Code Events #####
sketchybar --add event claude_status_change

##### Mode Indicator (always visible) #####
sketchybar --add item mode_indicator right \
           --subscribe mode_indicator aerospace_mode_change \
           --set mode_indicator \
           icon="󰍹" \
           icon.font="Hack Nerd Font:Bold:12.0" \
           icon.color=0xffffffff \
           icon.padding_left=8 \
           icon.padding_right=4 \
           label="MAIN" \
           label.font="Hack Nerd Font:Bold:10.0" \
           label.color=0xffffffff \
           label.padding_left=0 \
           label.padding_right=8 \
           background.color=$ACCENT_COLOR \
           background.corner_radius=5 \
           background.height=24 \
           background.drawing=on \
           script="$PLUGIN_DIR/mode.sh"

##### Claude Code Status (hidden by default, shown when waiting) #####
sketchybar --add item claude right \
           --subscribe claude claude_status_change front_app_switched aerospace_workspace_change \
           --set claude \
           drawing=off \
           icon="󰚩" \
           icon.font="Hack Nerd Font:Bold:14.0" \
           icon.color=0xff6c757d \
           icon.padding_left=8 \
           icon.padding_right=4 \
           label="" \
           label.font="Hack Nerd Font:Bold:10.0" \
           label.padding_left=0 \
           label.padding_right=8 \
           background.color=0x331e1f29 \
           background.corner_radius=5 \
           background.height=24 \
           background.drawing=on \
           script="$PLUGIN_DIR/claude.sh"

##### Trigger for app updates #####
sketchybar --add item app_trigger right \
           --subscribe app_trigger aerospace_workspace_change front_app_switched \
           --set app_trigger \
           drawing=off \
           script="$PLUGIN_DIR/workspace_apps.sh"

##### Trigger for workspace updates #####
sketchybar --add item workspace_trigger right \
           --subscribe workspace_trigger aerospace_workspace_change \
           --set workspace_trigger \
           drawing=off \
           script="$PLUGIN_DIR/workspaces.sh"

##### Initial workspace setup #####
"$PLUGIN_DIR/workspaces.sh"

##### Layout Popup Anchor (invisible, center position) #####
sketchybar --add item layout_anchor center \
           --set layout_anchor \
           icon.drawing=off \
           label.drawing=off \
           background.drawing=off \
           width=0 \
           popup.horizontal=off \
           popup.align=center \
           popup.y_offset=300 \
           popup.background.color=0xee1e1f29 \
           popup.background.corner_radius=12 \
           popup.background.border_color=$ACCENT_COLOR \
           popup.background.border_width=2 \
           popup.background.drawing=on

sketchybar --update
